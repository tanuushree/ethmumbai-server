generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Ticket {
  id       String  @id @default(uuid())
  title    String  @unique
  type     String
  fiat     Float   @default(999)
  crypto   Float   @default(12)
  quantity Int
  orders   Order[]
}

model Order {
  id                String            @id @default(uuid())
  razorpayOrderId   String?           @unique
  razorpayPaymentId String?           @unique
  daimoPaymentId    String?           @unique
  daimoTxHash       String?           @unique
  buyerName         String
  buyerEmail        String
  buyerPhone        String
  amount            Float
  currency          String            @default("INR")
  status            String            @default("created")
  paymentType       PaymentType?
  paymentVerified   Boolean           @default(false)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  razorpaySignature String?           @unique
  ticketId          String
  buyerEmailSent    Boolean           @default(false)
  buyerEmailSentAt  DateTime?
  generatedTickets  GeneratedTicket[]
  ticket            Ticket            @relation(fields: [ticketId], references: [id])
  participants      Participant[]
}

model Participant {
  id              String           @id @default(uuid())
  orderId         String
  name            String
  email           String?          @unique
  isBuyer         Boolean          @default(false)
  emailSent       Boolean          @default(false)
  emailSentAt     DateTime?
  generatedTicket GeneratedTicket?
  order           Order            @relation(fields: [orderId], references: [id])
}

model GeneratedTicket {
  id            String      @id @default(uuid())
  ticketCode    String      @unique
  participantId String      @unique
  orderId       String
  checkedIn     Boolean     @default(false)
  checkedInAt   DateTime    @default(now())
  qrHash        String      @unique
  qrUrl         String?
  order         Order       @relation(fields: [orderId], references: [id])
  participant   Participant @relation(fields: [participantId], references: [id])
}

enum PaymentType {
  RAZORPAY
  DAIMO
}
