generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// =======================
// Tickets Table
// =======================
model Ticket {
  id       String   @id @default(uuid())
  title    String   @unique
  type     String   // "earlybird" or "standard"
  fiat     Float   @default(999)
  crypto   Float   @default(12)
  quantity Int
  orders   Order[]
}

//
// =======================
// Order Table
// =======================
model Order {
  id                 String             @id @default(uuid())  

  // Razorpay fields
  razorpayOrderId    String?            @unique   // Razorpay: order_id
  razorpayPaymentId  String?            @unique   // Razorpay: payment_id
  razorpaySignature  String?            @unique   // Razorpay: signature_id

  // Daimo fields
  daimoPaymentId     String?            @unique   // Daimo: payId
  daimoTxHash        String?            @unique   // Daimo: blockchain transaction hash

  // Common order info
  ticketId           String
  buyerName          String
  buyerEmail         String
  buyerPhone         String
  amount             Float
  currency           String             @default("INR") // INR or CRYPTO (USDC)
  status             String             @default("created") // created, attempted, paid, failed
  paymentType        PaymentType?
  paymentVerified    Boolean            @default(false)

  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt

  // Relations
  ticket             Ticket             @relation(fields: [ticketId], references: [id])
  generatedTickets   GeneratedTicket[]        
  participants       Participant[]
}

//
// =======================
// Participant Table
// =======================
model Participant {
  id              String                @id @default(uuid()) // random unique participant ID
  orderId         String
  name            String
  email           String?               @unique
  isBuyer         Boolean               @default(false)
  generatedTicket GeneratedTicket?
  order           Order                 @relation(fields: [orderId], references: [id])
}


model GeneratedTicket {
  id            String                  @id @default(uuid())
  ticketCode    String                  @unique        // this is your unique ticket ID
  participantId String                  @unique
  orderId       String

  participant Participant               @relation(fields: [participantId], references: [id])
  order       Order                     @relation(fields: [orderId], references: [id])
}

// =======================
// Payment Type Enum
// =======================
enum PaymentType {
  RAZORPAY
  DAIMO
}
